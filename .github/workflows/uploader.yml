name: Uploader

on:
  workflow_dispatch: # manual trigger
  schedule:
    - cron: "0 */6 * * *" # every 6 hours

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install rclone
        run: |
          curl -Of https://downloads.rclone.org/rclone-current-linux-amd64.zip
          unzip rclone-current-linux-amd64.zip
          cd rclone-*-linux-amd64
          sudo cp rclone /usr/bin/
          rclone version

      - name: Configure rclone
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE_CONF }}" > ~/.config/rclone/rclone.conf

      - name: Download JSON file from Google Drive
        run: |
          wget "https://drive.google.com/uc?export=download&id=1VB9C9l38_PvxZAWs3fUtUw9bKKEavPBu" -O hindi_channels.json

      - name: Run uploader
        env:
          MONGO_URI: ${{ secrets.MONGO_URI }}
        run: |
          python uploader.py
